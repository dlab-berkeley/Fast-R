---
title: "Fast-R"
author: "D-Lab"
date: "11/8/2018"
output:
  word_document:
    toc: yes
  html_document:
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Download these materials
Visit this [GitHub repository]() to download these materials. 
1. Click the green "CLone or Download" button  
2. Click "Download zip"
3. Extract these files to your Desktop

This is an [.HTML](https://html.com/) file made using [RMarkdown and knitr](https://rmarkdown.rstudio.com/) and will serve as our guide. Also open the "script.R" file - that is where you will show your work! 

# Introduction to R
This two-part workshop series will teach you the basics of R programming for "doing research". 

##### Click these links to learn more about D-Lab:
* [workshops](http://dlab.berkeley.edu/training)
* [working groups](http://dlab.berkeley.edu/working-groups)
* [consulting services](http://dlab.berkeley.edu/consulting)
* [data resources](http://dlab.berkeley.edu/data-resources). 
  * View the [calendar](http://dlab.berkeley.edu/calendar-node-field-date) for a compact view

##### The first two hours will cover:
* How to **navigate RStudio**
* **Variable Assignment** - how to save data in R
* Different **Data Types** - numeric, integer, character, logical, factor
* Different **Data Structures** - vectors, lists, matrices, and data frames
* Loading a dataset from a .csv file on your computer
* Subsetting your data - one column at a time, or by rows and columns
* Saving your data and figures
  
##### The second two hours:
* **Data summarization**
* **Visualization**
* **Testing**

### How to use R to "do research"
R can do [a lot!](https://en.wikipedia.org/wiki/R_(programming_language)) R makes it easy to import, clean, summarize, visualize, and test data. Start by thinking about your own interests. 

Read literature in your field to help you ask a well-informed research question - where are there gaps in the research? In which directions is research going? What is worthwhile to you? What is possible? What is too much? 

You can turn these questions into sets of [testable hypotheses](http://mathworld.wolfram.com/HypothesisTesting.html) and use data summaries, visualizations, and tests to interpret your conclusions. 

# Navigating RStudio
1. Script (upper left window pane)
  * Scripts are where you can write your **input**
  * Click File --> New File --> R Script
  * Code are the instructions we write to accomplish tasks
  * R syntax is highly specific and case sensitive! 
  # `Command + Enter` (Mac) and `Ctrl + Enter` (PC) will run a line of code. 
2. Console (lower left)
  * This is your **output**
  * You can also type directly into the console, but it is harder to save than the script. For this reason it is fun to mess around in the console. 
  * `>` is the prompt - this means RStudio is waiting for you to give it instructions. 
3. Global environment (upper right)
  * When you save data into R as variables (see below), they actually live in a physical place. 
4. Plots, packages, help (lower right)
  * Plots - this is where your visualizations will appear
  * Packages - install packages here
  * Help - the help files are really helpful, you just don't know it yet! 

# Variable Assignment
Data are saved into R's memory via variables. Think of a simple three-piece recipe to assign a variable:
1. Left side: unique_name
2. Middle: equals sign
3. Right side: value, expression, other variable, function, or code to be evaluated. 

Let's try it. In your "Fast-R.R" script. In which window pane do these variables appear in RStudio? 
```{r}
# define the variable
x = 5

# "call" (retrieve) the variable
x
```

# Data types 
The `class()` function will tell us what type of data a variable is. The most common types are: 
* Numeric - this is the default type for all numbers in R
* Integer - negative and positive whole numbers, including zero
* Character - always wrapped in quotations! `" "`
* Logical - only two options (TRUE and FALSE)
* Factor - categorical data

> NOTE: for integer data, we must coerce (change) numeric to integer type with the `as.integer()`. Also try using `as.numeric()`, `as.character()`, `as.logical()`, and `as.factor()`. What happens? Does it always work? 

```{r}
name = "Max"
major = "IRLE"
age = 22
enrolled = TRUE

class(name)
class(major)
class(age)
class(enrolled)
```

# Data structures
One obvious reason to use R is because we can store complex data inside of a single variable! 

### Vectors
Vectors are organized groups of the same type of data. It doesn't matter what type the data are, as long as they are all the same. 

Use the `c()` function to concatenate some vectors. 
```{r}
# Numeric vector
vec_num = c(11.41, 7.23, 6.78, 8.12, 5.43, 9.34, 10.23, 5.21)

# Integer vector
vec_int = c(1L, 4L, 6L, 8L, 12L, 14L, 7L, 3L)

# Character vector
vec_char = c("Oakland", "SF", "Oakland", "SF", "Berkeley", "Berkeley", "Oakland", "Berkeley")

# Logical vector
vec_logi = c(T, F, F, T)
```

### Data frame
Data frames are ordered groups of equal length vectors. The `data.frame()` function will combine equal-length vectors into a data frame. 
```{r}
data = data.frame(vec_num, vec_int, vec_char, vec_logi)
data
```

We can rename columns of our data frame by passing in a vector of equal length to the `colnames()` function:
```{r}
colnames(data) = c("Time", "Hour", "Location", "Passed")
data
```

# Load data from files
The `read.csv()` function makes it super easy to load data from files. However you first must set your "working directory", or the folder location on your computer that RStudio is pointing to. 

Click Session --> Set Working Directory --> Choose Directory, and set it to your "Fast-R" folder. 

`getwd()` will show us the path location of this folder. 
`dir()` will show us the contents of this folder. 
`ls()` will list the variables in our global environment (same as the upper right window pane).

Let's load the "gapminder-FiveYearData.csv" dataset as a variable named `gap` and explore it. 
```{r}
gap = read.csv("gapminder-FiveYearData.csv")
head(gap)

# View(gap) is also helpful! 
```

What do these functions do? 
`str(gap)`
`nrow(gap)`
`ncol(gap)`
`dim(gap)`
`names(gap)`
```{r}
str(gap)
nrow(gap)
ncol(gap)
dim(gap)
names(gap)
```

# Getting help
Remember to type a question mark before the name of a function to view its help pages
```{r}
?mean
?median
?table
?hist
?t.test
?cor.test
?lm
```

# Subsetting your data
Once you get data loaded into R, you might want to clean it up (i.e., fix spelling variations, typos, formatting, etc.) but you might need to subset it - you might only be interested in certain ranges of values. 

### In one dimension `$`
The dollar sign operator will extract one single column. 
```{r, eval = F}
gap$country
gap$year
```

### In two dimensions `[ , ]`
Bracket notation is an open and closed bracket with a comma in the middle. Everything before the comma refers to rows, everything after refers to columns. 

For example, `gap_sub = gap[c(1:8, 10) , c(2:4)]` will extract only  
  * rows 1 thru 8 and 10, and 
  * columns 2 thru 4
... and will save it in a new variable named `gap_sub`

Let's try it! 
```{r}
gap_sub = gap[c(1:8, 10) , c(2:4)]
gap_sub
```

# Data summarization
You can use the `table()`, `prop.table()`, and `summary()` functions to get useful information
```{r}
table(gap$continent)
table(gap$continent, gap$year)
prop.table(table(gap$continent))
summary(gap)
summary(gap$lifeExp)
```

# Visualization
1. `hist()` will create a histogram of one continuous variable. 
2. `boxplot()` will create boxplots of one factor and one continuous variable. 
3. `plot()` will create a scatterplot of two continuous variables.

> Note the other plotting arguments! 

```{r}
hist(gap$lifeExp,
     # Change bar colors
     col = "yellow",
     # x-axis label
     xlab = "Life expectancy (years)",
     # y-axis label
     ylab = "FREQUENCY",
     # Title
     main = "Histogram of life expectancy",
     # Tick mark orientation
     las = 1)

boxplot(gap$lifeExp ~ gap$continent, 
        col = 2:6,
        xlab = "Continent", 
        ylab = "Age in years",
        main = "Boxplots of life expectancy by continent",
        las = 1)

plot(x = gap$lifeExp, y = gap$gdpPercap)
```

Click the "Export" button to save it as a .PDF and export it to .TIFF! 

What does this code do? Click the first [Useful link](https://ggplot2.tidyverse.org/) to read more about part 2!
```{r, eval = F}
install.packages("ggplot2")
library(ggplot2)
?ggplot2
```

# Statistical testing
What does this function do? Check out [this excellent blog post](http://blog.yhat.com/posts/r-lm-summary.html) to learn more. 
```{r, eval = F}
?lm
```

We can fit a linear regression model with only a small amount of code. However, remember to always check a test's [statistical assumptions](http://www.sthda.com/english/wiki/statistical-tests-and-assumptions) before applying it! 
```{r}
gap_lm = lm(gap$gdpPercap ~ gap$lifeExp)
summary(gap_lm)
```

Learn more about linear models by [clicking here.](http://blog.yhat.com/posts/r-lm-summary.html)

# Key points:
1. Data are saved in **variables** 
2. Syntax for **Variable Assignment** Looks like this:
  * `x = 5` (numeric)
  * `y = cos(pi)` (numeric)
  * `city = "Berkeley"` (character)
  * `value = TRUE` (logical)
  * `factor1 = factor(variable_name)` (factor)
3. R is comprised of functions and arguments:
  * **Functions** perform an action on a thing
  * These "things" are called **arguments** - values, expressions, other variables, and even entire datasets. They can also be options inside of functions that we can define or turn on or off or otherwise define somehow. 
4. All variables in are have a `class`, or type. A variable's **class** determines how we can manipulate that data. 
5. **Data structures** allow us to store more than a single number or word inside of a single variable: 
  * Vectors
  * Lists 
  * Matrices
  * Data frames
    - NOTE: lists and matrices will not be covered in this workshop. 
  - Concatenate a vector:
    `x = c(1, 4, 18, 981)`  or `y = c(T, F, F, T)` 
  - Create a data frame:
    `df = data.frame(x, y)`
6. We can **load data from files** and easily load data from Excel ([.CSV files](https://www.computerhope.com/issues/ch001356.htm) are preferred), and [many other softwares and types.](https://www.datacamp.com/community/tutorials/r-data-import-tutorial)
7. These data often need to be subsetted in one (`$`) or two dimensions (`[ , ]`) to make working with the data easier. 
8. Summarize
  * `table()`
  * `prop.table()`
  * `summary()`
9. Visualize
  * `hist()`
  * `boxplot()`
  * `plot()`
10. Test
  * `lm()`
  
# Bonus
The `ggplot()` function works in layers. Remember to add a plus sign `+` to the end of a line when you want to add another layer. You need three things to make a ggplot:
  1. Data
  2. "aes"thetics - define your x and y coordinates, colors, shapes
  3. geoms - how to represent the data - points, bars, boxes, etc.
    
For example: 
```{r}
# Make sure to first un-hashtag the below line to install the package
# install.packages("ggplot2")

library(ggplot2)
ggplot(data = gap, aes(x = lifeExp, y = gdpPercap, color = continent, shape = continent)) + 
  geom_point(size = 2, alpha = 0.5) + 
  ggtitle("Scatterplot of lifeExpt and gdpPercap") + 
  xlab("Life expectancy (years)") + 
  ylab("gdpPercap ($)") + 
  theme_bw() + 
  theme(legend.position = "top") + 
  theme(plot.title = element_text(hjust = 0.5))
```







